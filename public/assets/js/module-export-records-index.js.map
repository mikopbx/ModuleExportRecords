{"version":3,"sources":["src/module-export-records-index.js"],"names":["idUrl","idForm","className","inputClassName","ModuleExtendedCDRs","$formObj","$","$checkBoxes","$dropDowns","saveTableAJAXUrl","globalRootUrl","deleteRecordAJAXUrl","$disabilityFields","$statusToggle","$moduleStatus","$cdrTable","$globalSearch","$dateRangeSelector","dataTable","players","validateRules","initialize","removeClass","initializeDateRangeSelector","window","checkbox","dropdown","onChange","applyFilter","addEventListener","checkStatusToggle","initializeForm","tab","on","e","startCreateExcelPDF","saveSearchSettings","keyCode","val","length","keydown","event","preventDefault","search","getSearchText","serverSide","processing","info","columnDefs","defaultContent","targets","ajax","url","type","dataSrc","json","html","recordsFiltered","recordsIncoming","recordsMissed","recordsOutgoing","typeCall","attr","data","paging","sDom","deferRender","pageLength","calculatePageLength","createdRow","row","detailedIcon","DT_RowClass","indexOf","eq","addClass","duration","ids","lineText","line","did","waitTime","stateCall","drawCallback","Extensions","updatePhonesRepresent","language","SemanticLocalization","dataTableLocalisation","ordering","DataTable","closest","filter","target","undefined","location","tr","hasClass","remove","after","showRecords","each","index","playerRow","id","CDRPlayer","updateSyncState","setInterval","divProgress","method","success","response","stateData","lastId","nowId","show","hide","progress","total","value","text","active","globalTranslate","repModuleExtendedCDRs_syncState","error","jqXHR","textStatus","errorThrown","console","htmlPlayer","forEach","record","i","srcAudio","srcDownloadAudio","recordingfile","recordFileName","encodeURIComponent","prettyFilename","recordFileUri","start","src_num","dst_num","billsec","stateCallIndex","rowHeight","find","first","outerHeight","windowHeight","innerHeight","headerFooterHeight","Math","max","floor","additionalExportFunctions","body","Date","now","newRow","nameCell","usersCell","buttonsCell","headersCell","append","table","rows","rowData","name","dstUrl","users","headers","push","rules","log","key","ruleSaveResult","hasOwnProperty","syncRules","replace","RegExp","xhr","status","showRuleOptions","modal","closable","removeRule","period","defPeriod","moment","periods","getStandardPeriods","options","ranges","repModuleExtendedCDRs_cdr_cal_Today","repModuleExtendedCDRs_cdr_cal_Yesterday","subtract","repModuleExtendedCDRs_cdr_cal_LastWeek","repModuleExtendedCDRs_cdr_cal_Last30Days","repModuleExtendedCDRs_cdr_cal_ThisMonth","startOf","endOf","repModuleExtendedCDRs_cdr_cal_LastMonth","alwaysShowCalendars","autoUpdateInput","linkedCalendars","maxDate","locale","format","separator","applyLabel","cal_ApplyBtn","cancelLabel","cal_CancelBtn","fromLabel","cal_from","toLabel","cal_to","customRangeLabel","cal_CustomPeriod","daysOfWeek","calendarText","days","monthNames","months","firstDay","startDate","endDate","daterangepicker","cbDateRangeSelectorOnSelect","end","label","draw","dateRangeSelector","globalSearch","additionalFilter","JSON","stringify","settings","flattenedData","item","baseRecord","nestedItem","columns","worksheet","XLSX","utils","json_to_sheet","header","skipHeader","sheet_add_aoa","repModuleExtendedCDRs_cdr_ColumnTypeState","cdr_ColumnDate","cdr_ColumnFrom","cdr_ColumnTo","repModuleExtendedCDRs_cdr_ColumnLine","repModuleExtendedCDRs_cdr_ColumnWaitTime","cdr_ColumnDuration","repModuleExtendedCDRs_cdr_ColumnCallState","origin","map","col","wch","getMaxWidth","workbook","book_new","book_append_sheet","writeFile","tableBody","style","docDefinition","pageOrientation","content","headerRows","widths","layout","fillColor","rowIndex","node","columnIndex","styles","fontSize","bold","margin","tableHeader","color","alignment","pdfMake","createPdf","download","maxLength","toString","startDownload","startTime","endTime","typeRec","numbers","open","startDownloadHistory","makeDropdownList","selectType","selected","values","obj","changeGroupInList","choice","tdInput","currentRowId","tableName","sendChangesToServer","initTable","columnsArray4Sort","colName","ajaxUrl","infoCallback","pre","cols","templateDeleteButton","DT_RowId","bt_ToolTipDelete","template","additionalClass","selectMetaData","newTemplate","drowSelectGroup","sTableId","transition","document","which","endEditInput","deleteRow","addNewRow","cbOnDrop","priorityWasChanged","priorityData","ruleId","oldPriority","parseInt","newPriority","isNaN","api","$el","idTable","random","rowTemplate","before","tableId","selestGroup","tableDnD","onDrop","onDragClass","dragHandle","substr","onSuccess","recordId","notEmpty","successTest","Object","keys","rowId","onFailure","message","UserMessage","showMultiString","onError","errorMessage","element","applyConfigurationChanges","changeStatus","Config","pbxUrl","result","cbBeforeSendForm","form","cbAfterSendForm","Form","module_export_recordsConnected","module_export_recordsDisconnected","module_export_recordsUpdateStatus","ready"],"mappings":"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","sourcesContent":["/*\n * Copyright (C) MIKO LLC - All Rights Reserved\n * Unauthorized copying of this file, via any medium is strictly prohibited\n * Proprietary and confidential\n * Written by Nikolay Beketov, 11 2018\n *\n */\nconst idUrl     = 'module-extended-c-d-rs';\nconst idForm    = 'module-extended-cdr-form';\nconst className = 'ModuleExtendedCDRs';\nconst inputClassName = 'mikopbx-module-input';\n\n/* global globalRootUrl, globalTranslate, Form, Config */\nconst ModuleExtendedCDRs = {\n\t$formObj: $('#'+idForm),\n\t$checkBoxes: $('#'+idForm+' .ui.checkbox'),\n\t$dropDowns: $('#'+idForm+' .ui.dropdown'),\n\tsaveTableAJAXUrl: globalRootUrl + idUrl + \"/saveTableData\",\n\tdeleteRecordAJAXUrl: globalRootUrl + idUrl + \"/delete\",\n\t$disabilityFields: $('#'+idForm+'  .disability'),\n\t$statusToggle: $('#module-status-toggle'),\n\t$moduleStatus: $('#status'),\n\n\t/**\n\t * The call detail records table element.\n\t * @type {jQuery}\n\t */\n\t$cdrTable: $('#cdr-table'),\n\n\t/**\n\t * The global search input element.\n\t * @type {jQuery}\n\t */\n\t$globalSearch: $('#globalsearch'),\n\n\t/**\n\t * The date range selector element.\n\t * @type {jQuery}\n\t */\n\t$dateRangeSelector: $('#date-range-selector'),\n\n\t/**\n\t * The data table object.\n\t * @type {Object}\n\t */\n\tdataTable: {},\n\n\t/**\n\t * An array of players.\n\t * @type {Array}\n\t */\n\tplayers: [],\n\n\t/**\n\t * Field validation rules\n\t * https://semantic-ui.com/behaviors/form.html\n\t */\n\tvalidateRules: {\n\t},\n\t/**\n\t * On page load we init some Semantic UI library\n\t */\n\tinitialize() {\n\t\t// Удаляем отступы контейнера.\n\t\t$('#main-content-container').removeClass('container');\n\t\tModuleExtendedCDRs.initializeDateRangeSelector();\n\t\t// инициализируем чекбоксы и выподающие менюшки\n\t\twindow[className].$checkBoxes.checkbox();\n\t\twindow[className].$dropDowns.dropdown({onChange: ModuleExtendedCDRs.applyFilter});\n\n\t\twindow.addEventListener('ModuleStatusChanged', window[className].checkStatusToggle);\n\t\twindow[className].initializeForm();\n\n\t\t$('.menu .item').tab();\n\t\t$('#typeCall.menu a.item').on('click', function (e) {\n\t\t\tModuleExtendedCDRs.applyFilter();\n\t\t});\n\t\t$('#createExcelButton').on('click', function (e) {\n\t\t\tModuleExtendedCDRs.startCreateExcelPDF('excel');\n\t\t});\n\t\t$('#createPdfButton').on('click', function (e) {\n\t\t\tModuleExtendedCDRs.startCreateExcelPDF('pdf');\n\t\t});\n\t\t$('#saveSearchSettings').on('click', function (e) {\n\t\t\tModuleExtendedCDRs.saveSearchSettings();\n\t\t});\n\n\t\tModuleExtendedCDRs.$globalSearch.on('keyup', (e) => {\n\t\t\tif (e.keyCode === 13\n\t\t\t\t|| e.keyCode === 8\n\t\t\t\t|| ModuleExtendedCDRs.$globalSearch.val().length === 0) {\n\t\t\t\tModuleExtendedCDRs.applyFilter();\n\t\t\t}\n\t\t});\n\n\t\tModuleExtendedCDRs.$formObj.keydown(function(event){\n\t\t\tif(event.keyCode === 13) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\n\t\tModuleExtendedCDRs.$cdrTable.dataTable({\n\t\t\tsearch: {\n\t\t\t\tsearch: ModuleExtendedCDRs.getSearchText(),\n\t\t\t},\n\t\t\tserverSide: true,\n\t\t\tprocessing: true,\n\t\t\tinfo: false,\n\t\t\tcolumnDefs: [\n\t\t\t\t{ defaultContent: \"-\",  targets: \"_all\"},\n\t\t\t],\n\t\t\tajax: {\n\t\t\t\turl: `${globalRootUrl}${idUrl}/getHistory`,\n\t\t\t\ttype: 'POST',\n\t\t\t\tdataSrc: function(json) {\n\t\t\t\t\t$('a.item[data-tab=\"all-calls\"] b').html(': '+json.recordsFiltered)\n\t\t\t\t\t$('a.item[data-tab=\"incoming-calls\"] b').html(': '+json.recordsIncoming)\n\t\t\t\t\t$('a.item[data-tab=\"missed-calls\"] b').html(': '+json.recordsMissed)\n\t\t\t\t\t$('a.item[data-tab=\"outgoing-calls\"] b').html(': '+json.recordsOutgoing)\n\n\t\t\t\t\tlet typeCall = $('#typeCall a.item.active').attr('data-tab');\n\t\t\t\t\tif(typeCall === 'incoming-calls'){\n\t\t\t\t\t\tjson.recordsFiltered = json.recordsIncoming;\n\t\t\t\t\t}else if(typeCall === 'missed-calls'){\n\t\t\t\t\t\tjson.recordsFiltered = json.recordsMissed;\n\t\t\t\t\t}else if(typeCall === 'outgoing-calls'){\n\t\t\t\t\t\tjson.recordsFiltered = json.recordsOutgoing;\n\t\t\t\t\t}\n\t\t\t\t\treturn json.data;\n\t\t\t\t}\n\t\t\t},\n\t\t\tpaging: true,\n\t\t\tsDom: 'rtip',\n\t\t\tdeferRender: true,\n\t\t\tpageLength: ModuleExtendedCDRs.calculatePageLength(),\n\n\t\t\t/**\n\t\t\t * Constructs the CDR row.\n\t\t\t * @param {HTMLElement} row - The row element.\n\t\t\t * @param {Array} data - The row data.\n\t\t\t */\n\t\t\tcreatedRow(row, data) {\n\t\t\t\tlet detailedIcon = '';\n\t\t\t\tif (data.DT_RowClass.indexOf(\"detailed\") >= 0) {\n\t\t\t\t\tdetailedIcon = '<i class=\"icon caret down\"></i>';\n\t\t\t\t}\n\t\t\t\tif(data.typeCall === '1'){\n\t\t\t\t\t$('td', row).eq(0).html('<i class=\"custom-outgoing-icon-15x15\"></i>'+detailedIcon);\n\t\t\t\t}else if(data.typeCall === '2'){\n\t\t\t\t\t$('td', row).eq(0).html('<i class=\"custom-incoming-icon-15x15\"></i>'+detailedIcon);\n\t\t\t\t}else if(data.typeCall === '3'){\n\t\t\t\t\t$('td', row).eq(0).html('<i class=\"custom-missed-icon-15x15\"></i>'+detailedIcon);\n\t\t\t\t}else{\n\t\t\t\t\t$('td', row).eq(0).html(''+detailedIcon);\n\t\t\t\t}\n\n\t\t\t\t$('td', row).eq(1).html(data[0]).addClass('right aligned');;\n\t\t\t\t$('td', row).eq(2)\n\t\t\t\t\t.html(data[1])\n\t\t\t\t\t.attr('data-phone',data[1])\n\t\t\t\t\t.addClass('need-update').addClass('right aligned');;\n\t\t\t\t$('td', row).eq(3)\n\t\t\t\t\t.html(data[2])\n\t\t\t\t\t.attr('data-phone',data[2])\n\t\t\t\t\t.addClass('need-update');\n\n\t\t\t\tlet duration = data[3];\n\t\t\t\tif (data.ids !== '') {\n\t\t\t\t\tduration += '<i data-ids=\"' + data.ids + '\" class=\"file alternate outline icon\">';\n\t\t\t\t}\n\n\t\t\t\tlet lineText = data.line;\n\t\t\t\tif(data.did !== \"\"){\n\t\t\t\t\tlineText = `${data.line} <a class=\"ui mini basic label\">${data.did}</a>`;\n\t\t\t\t}\n\t\t\t\t$('td', row).eq(4).html(lineText).addClass('right aligned');\n\n\t\t\t\t$('td', row).eq(5).html(data.waitTime).addClass('right aligned');\n\t\t\t\t$('td', row).eq(6).html(duration).addClass('right aligned');\n\t\t\t\t$('td', row).eq(7).html(data.stateCall).addClass('right aligned');\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Draw event - fired once the table has completed a draw.\n\t\t\t */\n\t\t\tdrawCallback() {\n\t\t\t\tExtensions.updatePhonesRepresent('need-update');\n\t\t\t},\n\t\t\tlanguage: SemanticLocalization.dataTableLocalisation,\n\t\t\tordering: false,\n\t\t});\n\t\tModuleExtendedCDRs.dataTable = ModuleExtendedCDRs.$cdrTable.DataTable();\n\t\tModuleExtendedCDRs.dataTable.on('draw', () => {\n\t\t\tModuleExtendedCDRs.$globalSearch.closest('div').removeClass('loading');\n\t\t});\n\n\t\tModuleExtendedCDRs.$cdrTable.on('click', 'tr.negative', (e) => {\n\t\t\tlet filter = $(e.target).attr('data-phone');\n\t\t\tif (filter !== undefined && filter !== '') {\n\t\t\t\tModuleExtendedCDRs.$globalSearch.val(filter)\n\t\t\t\tModuleExtendedCDRs.applyFilter();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet ids = $(e.target).attr('data-ids');\n\t\t\tif (ids !== undefined && ids !== '') {\n\t\t\t\twindow.location = `${globalRootUrl}system-diagnostic/index/?filename=asterisk/verbose&filter=${ids}`;\n\t\t\t}\n\t\t});\n\n\t\t// Add event listener for opening and closing details\n\t\tModuleExtendedCDRs.$cdrTable.on('click', 'tr.detailed', (e) => {\n\t\t\tlet ids = $(e.target).attr('data-ids');\n\t\t\tif (ids !== undefined && ids !== '') {\n\t\t\t\twindow.location = `${globalRootUrl}system-diagnostic/index/?filename=asterisk/verbose&filter=${ids}`;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet filter = $(e.target).attr('data-phone');\n\t\t\tif (filter !== undefined && filter !== '') {\n\t\t\t\tModuleExtendedCDRs.$globalSearch.val(filter)\n\t\t\t\tModuleExtendedCDRs.applyFilter();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst tr = $(e.target).closest('tr');\n\t\t\tconst row = ModuleExtendedCDRs.dataTable.row(tr);\n\t\t\tif(row.length === 0){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (tr.hasClass('shown')) {\n\t\t\t\t// This row is already open - close it\n\t\t\t\t$('tr[data-row-id=\"'+tr.attr('id')+'-detailed\"').remove();\n\t\t\t\ttr.removeClass('shown');\n\t\t\t} else {\n\t\t\t\t// Open this row\n\t\t\t\ttr.after(ModuleExtendedCDRs.showRecords(row.data() , tr.attr('id')));\n\t\t\t\ttr.addClass('shown');\n\t\t\t\t$('tr[data-row-id=\"'+tr.attr('id')+'-detailed\"').each((index, playerRow) => {\n\t\t\t\t\tconst id = $(playerRow).attr('id');\n\t\t\t\t\treturn new CDRPlayer(id);\n\t\t\t\t});\n\t\t\t\tExtensions.updatePhonesRepresent('need-update');\n\t\t\t}\n\t\t});\n\n\t\twindow[className].updateSyncState();\n\t\tsetInterval(window[className].updateSyncState, 5000);\n\t},\n\n\t/**\n\t *\n\t */\n\tupdateSyncState(){\n\t\t// Выполняем GET-запрос\n\t\tlet divProgress = $(\"#sync-progress\");\n\t\t$.ajax({\n\t\t\turl: `${globalRootUrl}${idUrl}/getState`,\n\t\t\tmethod: 'GET',\n\t\t\tsuccess: function(response) {\n\t\t\t\tif(response.stateData.lastId - response.stateData.nowId > 0){\n\t\t\t\t\tdivProgress.show();\n\t\t\t\t}else{\n\t\t\t\t\tdivProgress.hide();\n\t\t\t\t}\n\t\t\t\tdivProgress.progress({\n\t\t\t\t\ttotal: response.stateData.lastId, value: response.stateData.nowId,\n\t\t\t\t\ttext: {\n\t\t\t\t\t\tactive  : globalTranslate.repModuleExtendedCDRs_syncState\n\t\t\t\t\t},\n\t\t\t\t\terror: function(jqXHR, textStatus, errorThrown) {\n\t\t\t\t\t\t// Обработка ошибки\n\t\t\t\t\t\tconsole.error('Ошибка запроса:', textStatus, errorThrown);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Shows a set of call records when a row is clicked.\n\t * @param {Array} data - The row data.\n\t * @returns {string} The HTML representation of the call records.\n\t */\n\tshowRecords(data, id) {\n\t\tlet htmlPlayer = '';\n\t\tdata[4].forEach((record, i) => {\n\t\t\tlet srcAudio = '';\n\t\t\tlet srcDownloadAudio = '';\n\t\t\tif (!(record.recordingfile === undefined || record.recordingfile === null || record.recordingfile.length === 0)) {\n\t\t\t\tlet recordFileName = encodeURIComponent(record.prettyFilename);\n\t\t\t\tconst recordFileUri = encodeURIComponent(record.recordingfile);\n\t\t\t\tsrcAudio = `/pbxcore/api/cdr/v2/playback?view=${recordFileUri}`;\n\t\t\t\tsrcDownloadAudio = `/pbxcore/api/cdr/v2/playback?view=${recordFileUri}&download=1&filename=${recordFileName}.mp3`;\n\t\t\t}\n\n\t\t\thtmlPlayer +=`\n\t\t\t<tr id=\"${record.id}\" data-row-id=\"${id}-detailed\" class=\"warning detailed odd shown\" role=\"row\">\n\t\t\t\t<td></td>\n\t\t\t\t<td class=\"right aligned\">${record.start}</td>\n\t\t\t\t<td data-phone=\"${record.src_num}\" class=\"right aligned need-update\">${record.src_num}</td>\n\t\t\t   \t<td data-phone=\"${record.dst_num}\" class=\"left aligned need-update\">${record.dst_num}</td>\n\t\t\t\t<td class=\"right aligned\">\t\t\t\n\t\t\t\t</td>\n\t\t\t\t<td class=\"right aligned\">${record.waitTime}</td>\n\t\t\t\t<td class=\"right aligned\">\n\t\t\t\t\t<i class=\"ui icon play\"></i>\n\t\t\t\t\t<audio preload=\"metadata\" id=\"audio-player-${record.id}\" src=\"${srcAudio}\"></audio>\n\t\t\t\t\t${record.billsec}\n\t\t\t\t\t<i class=\"ui icon download\" data-value=\"${srcDownloadAudio}\"></i>\n\t\t\t\t</td>\n\t\t\t\t<td class=\"right aligned\" data-state-index=\"${record.stateCallIndex}\">${record.stateCall}</td>\n\t\t\t</tr>`\n\t\t});\n\t\treturn htmlPlayer;\n\t},\n\n\tcalculatePageLength() {\n\t\t// Calculate row height\n\t\tlet rowHeight = ModuleExtendedCDRs.$cdrTable.find('tbody > tr').first().outerHeight();\n\n\t\t// Calculate window height and available space for table\n\t\tconst windowHeight = window.innerHeight;\n\t\tconst headerFooterHeight = 400 + 50; // Estimate height for header, footer, and other elements\n\n\t\t// Calculate new page length\n\t\treturn Math.max(Math.floor((windowHeight - headerFooterHeight) / rowHeight), 5);\n\t},\n\n\n\tadditionalExportFunctions(){\n\t\tlet body = $('body');\n\t\tbody.on('click', '#add-new-button', function (e) {\n\t\t\tlet id = 'none-'+Date.now();\n\t\t\tlet newRow \t= $('<tr>').attr('id', id);\n\t\t\tlet nameCell = $('<td>').attr('data-label', 'name').addClass('right aligned').html('<div class=\"ui mini icon input\"><input type=\"text\" placeholder=\"\" value=\"\"></div>');\n\t\t\tlet usersCell \t= $('<td>').attr('data-label', 'users').html('<div class=\"ui multiple dropdown\">' + $('#users-selector').html() +  '<div>');\n\t\t\tlet buttonsCell\t= $('<td>').attr('data-label', 'buttons').html('<div class=\"ui buttons\">\\n' +\n\t\t\t\t'                  <button class=\"compact ui icon basic button\" data-action=\"settings\" onclick=\"ModuleExtendedCDRs.showRuleOptions(\\''+id+'\\')\">\\n' +\n\t\t\t\t'                    <i class=\"cog icon\"></i>\\n' +\n\t\t\t\t'                  </button>\\n' +\n\t\t\t\t'                  <button class=\"compact ui icon basic button\" data-action=\"remove\" onclick=\"ModuleExtendedCDRs.removeRule(\\''+id+'\\')\">\\n' +\n\t\t\t\t'                    <i class=\"icon trash red\"></i>\\n' +\n\t\t\t\t'                  </button>\\n' +\n\t\t\t\t'                </div>');\n\t\t\tlet headersCell = $('<td>').attr('data-label', 'headers').addClass('right aligned').attr('style', 'display: none').html('<div class=\"ui modal segment\" data-id=\"'+id+'\">\\n' +\n\t\t\t\t'                  <i class=\"close icon\"></i>\\n' +\n\t\t\t\t'                    <div class=\"ui form\">\\n' +\n\t\t\t\t'                      <div class=\"field\">\\n' +\n\t\t\t\t'                        <label>HTTP Headers</label>\\n' +\n\t\t\t\t'                        <textarea></textarea>\\n' +\n\t\t\t\t'                      </div>\\n' +\n\t\t\t\t'                      <div class=\"field\">\\n' +\n\t\t\t\t'                        <label>URL</label>\\n' +\n\t\t\t\t'                        <div class=\"ui icon input\"><input data-label=\"dstUrl\" type=\"text\" placeholder=\"\" value=\"\"></div>\\n' +\n\t\t\t\t'                      </div>\\n' +\n\t\t\t\t'                    </div>\\n' +\n\t\t\t\t'                  <div class=\"actions\">\\n' +\n\t\t\t\t'                    <div class=\"ui positive right labeled icon button\">\\n' +\n\t\t\t\t'                      Завершить редактирование\\n' +\n\t\t\t\t'                      <i class=\"checkmark icon\"></i>\\n' +\n\t\t\t\t'                    </div>\\n' +\n\t\t\t\t'                  </div>\\n' +\n\t\t\t\t'                </div>');\n\t\t\tnewRow.append(nameCell, usersCell, headersCell, buttonsCell);\n\t\t\t$('#sync-rules').append(newRow);\n\t\t\t$('div.dropdown').dropdown();\n\t\t});\n\n\t\tbody.on('click', '#save-button', function (e) {\n\t\t\t// Обойдите элементы в цикле\n\t\t\t$(\"input\").each(function(index) {\n\t\t\t\t$(this).attr('value', $(this).val());\n\t\t\t});\n\n\t\t\tlet data = [];\n\t\t\tlet table = $('#sync-rules');\n\t\t\tlet rows = table.find('tbody tr');\n\t\t\trows.each(function() {\n\t\t\t\tlet row = $(this);\n\t\t\t\tlet rowData = {\n\t\t\t\t\tid: row.attr('id'),\n\t\t\t\t\tname:  row.find('td[data-label=\"name\"] input').val(),\n\t\t\t\t\tdstUrl:  $('.ui.modal[data-id=\"'+row.attr('id')+'\"] input[data-label=\"dstUrl\"]').val(),\n\t\t\t\t\tusers:   row.find('td[data-label=\"users\"] div.dropdown').dropdown('get value'),\n\t\t\t\t\theaders: $('.ui.modal[data-id=\"'+row.attr('id')+'\"] textarea').val()\n\t\t\t\t};\n\t\t\t\tdata.push(rowData);\n\t\t\t});\n\t\t\t$.ajax({\n\t\t\t\ttype: \"POST\",\n\t\t\t\turl:  globalRootUrl + idUrl + \"/save\",\n\t\t\t\tdata: {rules: data},\n\t\t\t\tsuccess: function(response) {\n\t\t\t\t\tconsole.log(\"Успешный запрос\", response);\n\t\t\t\t\tfor (let key in response.ruleSaveResult) {\n\t\t\t\t\t\tif (response.ruleSaveResult.hasOwnProperty(key)) {\n\t\t\t\t\t\t\tlet syncRules = $('#sync-rules tr#'+key);\n\t\t\t\t\t\t\tlet html = syncRules.html();\n\t\t\t\t\t\t\tsyncRules.html(html.replace((new RegExp(key, \"g\")), response.ruleSaveResult[key]));\n\t\t\t\t\t\t\tsyncRules.attr('id', response.ruleSaveResult[key]);\n\t\t\t\t\t\t\t$('.ui.modal[data-id=\"'+key+'\"]').attr('data-id', response.ruleSaveResult[key]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror: function(xhr, status, error) {\n\t\t\t\t\tconsole.error(\"Ошибка запроса\", status, error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\tshowRuleOptions(id) {\n\t\t$('.ui.modal[data-id=\"'+id+'\"]').modal({closable  : true, }).modal('show');\n\t},\n\tremoveRule(id) {\n\t\t$.ajax({\n\t\t\ttype: \"POST\",\n\t\t\turl:  globalRootUrl + idUrl + \"/delete\",\n\t\t\tdata: {\n\t\t\t\ttable: 'ExportRules',\n\t\t\t\tid: id\n\t\t\t},\n\t\t\tsuccess: function(response) {\n\t\t\t\tconsole.log(\"Успешный запрос\", response);\n\t\t\t\t$('#sync-rules tr#'+id).remove();\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(\"Ошибка запроса\", status, error);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Initializes the date range selector.\n\t */\n\tinitializeDateRangeSelector() {\n\n\t\tconst period = ModuleExtendedCDRs.$dateRangeSelector.attr('data-def-value');\n\t\tlet defPeriod = [moment(),moment()];\n\t\tif(period !== '' && period !== undefined){\n\t\t\tlet periods = ModuleExtendedCDRs.getStandardPeriods();\n\t\t\tif(periods[period] !== undefined){\n\t\t\t\tdefPeriod = periods[period];\n\t\t\t}\n\t\t}\n\n\t\tconst options = {};\n\t\toptions.ranges = {\n\t\t\t[globalTranslate.repModuleExtendedCDRs_cdr_cal_Today]: [moment(), moment()],\n\t\t\t[globalTranslate.repModuleExtendedCDRs_cdr_cal_Yesterday]: [moment().subtract(1, 'days'), moment().subtract(1, 'days')],\n\t\t\t[globalTranslate.repModuleExtendedCDRs_cdr_cal_LastWeek]: [moment().subtract(6, 'days'), moment()],\n\t\t\t[globalTranslate.repModuleExtendedCDRs_cdr_cal_Last30Days]: [moment().subtract(29, 'days'), moment()],\n\t\t\t[globalTranslate.repModuleExtendedCDRs_cdr_cal_ThisMonth]: [moment().startOf('month'), moment().endOf('month')],\n\t\t\t[globalTranslate.repModuleExtendedCDRs_cdr_cal_LastMonth]: [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],\n\t\t};\n\t\toptions.alwaysShowCalendars = true;\n\t\toptions.autoUpdateInput = true;\n\t\toptions.linkedCalendars = true;\n\t\toptions.maxDate = moment().endOf('month');\n\t\toptions.locale = {\n\t\t\tformat: 'DD/MM/YYYY',\n\t\t\tseparator: ' - ',\n\t\t\tapplyLabel: globalTranslate.cal_ApplyBtn,\n\t\t\tcancelLabel: globalTranslate.cal_CancelBtn,\n\t\t\tfromLabel: globalTranslate.cal_from,\n\t\t\ttoLabel: globalTranslate.cal_to,\n\t\t\tcustomRangeLabel: globalTranslate.cal_CustomPeriod,\n\t\t\tdaysOfWeek: SemanticLocalization.calendarText.days,\n\t\t\tmonthNames: SemanticLocalization.calendarText.months,\n\t\t\tfirstDay: 1,\n\t\t};\n\t\toptions.startDate = defPeriod[0];\n\t\toptions.endDate   = defPeriod[1];\n\t\tModuleExtendedCDRs.$dateRangeSelector.daterangepicker(\n\t\t\toptions,\n\t\t\tModuleExtendedCDRs.cbDateRangeSelectorOnSelect,\n\t\t);\n\t},\n\t/**\n\t * Handles the date range selector select event.\n\t * @param {moment.Moment} start - The start date.\n\t * @param {moment.Moment} end - The end date.\n\t * @param {string} label - The label.\n\t */\n\tcbDateRangeSelectorOnSelect(start, end, label) {\n\t\tModuleExtendedCDRs.$dateRangeSelector.attr('data-start', start.format('YYYY/MM/DD'));\n\t\tModuleExtendedCDRs.$dateRangeSelector.attr('data-end', moment(end.format('YYYYMMDD')).endOf('day').format('YYYY/MM/DD'));\n\t\tModuleExtendedCDRs.$dateRangeSelector.val(`${start.format('DD/MM/YYYY')} - ${end.format('DD/MM/YYYY') }`);\n\t\tModuleExtendedCDRs.applyFilter();\n\t},\n\n\t/**\n\t * Applies the filter to the data table.\n\t */\n\tapplyFilter() {\n\t\tconst text  = ModuleExtendedCDRs.getSearchText();\n\n\t\tModuleExtendedCDRs.dataTable.search(text).draw();\n\t\tModuleExtendedCDRs.$globalSearch.closest('div').addClass('loading');\n\t},\n\n\tgetSearchText() {\n\t\tconst filter = {\n\t\t\tdateRangeSelector: ModuleExtendedCDRs.$dateRangeSelector.val(),\n\t\t\tglobalSearch: ModuleExtendedCDRs.$globalSearch.val(),\n\t\t\ttypeCall: $('#typeCall a.item.active').attr('data-tab'),\n\t\t\tadditionalFilter: $('#additionalFilter').dropdown('get value').replace(/,/g,' '),\n\t\t};\n\t\treturn JSON.stringify(filter);\n\t},\n\n\tgetStandardPeriods(){\n\t\treturn {\n\t\t\t'cal_Today': [moment(), moment()],\n\t\t\t'cal_Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],\n\t\t\t'cal_LastWeek': [moment().subtract(6, 'days'), moment()],\n\t\t\t'cal_Last30Days': [moment().subtract(29, 'days'), moment()],\n\t\t\t'cal_ThisMonth': [moment().startOf('month'), moment().endOf('month')],\n\t\t\t'cal_LastMonth': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')],\n\t\t}\n\t},\n\n\tsaveSearchSettings() {\n\t\tlet periods = ModuleExtendedCDRs.getStandardPeriods();\n\t\tlet dateRangeSelector = '';\n\t\t$.each(periods,function(index,value){\n\t\t\tif(ModuleExtendedCDRs.$dateRangeSelector.val() ===  `${value[0].format('DD/MM/YYYY')} - ${value[1].format('DD/MM/YYYY')}`){\n\t\t\t\tdateRangeSelector = index;\n\t\t\t}\n\t\t});\n\t\tconst settings = {\n\t\t\t'additionalFilter' : $('#additionalFilter').dropdown('get value').replace(/,/g,' '),\n\t\t\t'dateRangeSelector' : dateRangeSelector\n\t\t};\n\t\t$.ajax({\n\t\t\turl: `${globalRootUrl}${idUrl}/saveSearchSettings`,\n\t\t\ttype: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\t'search[value]': JSON.stringify(settings),\n\t\t\t},\n\t\t\tsuccess: function(response) {\n\t\t\t\tconsole.log(response);\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t});\n\t},\n\n\tstartCreateExcelPDF(type) {\n\t\tconst text  = ModuleExtendedCDRs.getSearchText();\n\n\t\t$.ajax({\n\t\t\turl: `${globalRootUrl}${idUrl}/getHistory`,\n\t\t\ttype: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tdata: {\n\t\t\t\t'search[value]': text,\n\t\t\t},\n\t\t\tsuccess: function(response) {\n\t\t\t\tconst flattenedData = [ ];\n\n\t\t\t\t$.each(response.data, function(index, item) {\n\t\t\t\t\tconst baseRecord = {\n\t\t\t\t\t\tstart: item['0'],\n\t\t\t\t\t\tsrc_num: item['1'],\n\t\t\t\t\t\tdst_num: item['2'],\n\t\t\t\t\t\tbillsec: item['3'],\n\t\t\t\t\t\tstateCall: item['stateCall'],\n\t\t\t\t\t\ttypeCall: item['typeCallDesc'],\n\t\t\t\t\t\tline: item['line'],\n\t\t\t\t\t\twaitTime: item['waitTime'],\n\t\t\t\t\t\tid: item['DT_RowId']\n\t\t\t\t\t};\n\n\t\t\t\t\t// Добавляем основной элемент\n\t\t\t\t\tflattenedData.push(baseRecord);\n\n\t\t\t\t\t// Если есть вложенные данные, добавляем их сразу после основного элемента\n\t\t\t\t\tif (item['4'] && item['4'].length > 0) {\n\t\t\t\t\t\t$.each(item['4'], function(i, nestedItem) {\n\t\t\t\t\t\t\t// Проверяем, совпадают ли значения start, src_num и dst_num с основной записью\n\t\t\t\t\t\t\tif (nestedItem.start !== item['0'] || nestedItem.src_num !== item['1'] || nestedItem.dst_num !== item['2']) {\n\t\t\t\t\t\t\t\tflattenedData.push({\n\t\t\t\t\t\t\t\t\tstart: nestedItem.start || item['0'],\n\t\t\t\t\t\t\t\t\tsrc_num: nestedItem.src_num || item['1'],\n\t\t\t\t\t\t\t\t\tdst_num: nestedItem.dst_num || item['2'],\n\t\t\t\t\t\t\t\t\tbillsec: nestedItem.billsec || item['3'],\n\t\t\t\t\t\t\t\t\tstateCall: nestedItem.stateCall,\n\t\t\t\t\t\t\t\t\ttypeCall: item['typeCallDesc'],\n\t\t\t\t\t\t\t\t\tline: item['line'],\n\t\t\t\t\t\t\t\t\twaitTime: nestedItem.waitTime,\n\t\t\t\t\t\t\t\t\tid: item['DT_RowId']\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet columns = [\n\t\t\t\t\t\"typeCall\",\n\t\t\t\t\t\"start\",\n\t\t\t\t\t\"src_num\",\n\t\t\t\t\t\"dst_num\",\n\t\t\t\t\t\"line\",\n\t\t\t\t\t\"waitTime\",\n\t\t\t\t\t\"billsec\",\n\t\t\t\t\t\"stateCall\",\n\t\t\t\t\t\"id\"\n\t\t\t\t];\n\t\t\t\tif(type === 'excel'){\n\t\t\t\t\tconst worksheet = XLSX.utils.json_to_sheet(flattenedData,{\n\t\t\t\t\t\theader: columns,\n\t\t\t\t\t\tskipHeader: true  // Пропускаем автоматическое создание заголовков из ключей объекта\n\t\t\t\t\t});\n\t\t\t\t\tXLSX.utils.sheet_add_aoa(worksheet, [[\n\t\t\t\t\t\tglobalTranslate.repModuleExtendedCDRs_cdr_ColumnTypeState,\n\t\t\t\t\t\tglobalTranslate.cdr_ColumnDate,\n\t\t\t\t\t\tglobalTranslate.cdr_ColumnFrom,\n\t\t\t\t\t\tglobalTranslate.cdr_ColumnTo,\n\t\t\t\t\t\tglobalTranslate.repModuleExtendedCDRs_cdr_ColumnLine,\n\t\t\t\t\t\tglobalTranslate.repModuleExtendedCDRs_cdr_ColumnWaitTime,\n\t\t\t\t\t\tglobalTranslate.cdr_ColumnDuration,\n\t\t\t\t\t\tglobalTranslate.repModuleExtendedCDRs_cdr_ColumnCallState,\n\t\t\t\t\t\t'id',\n\t\t\t\t\t]], {origin: \"A1\"});\n\n\t\t\t\t\tworksheet['!cols'] =  columns.map(col => ({\n\t\t\t\t\t\twch: 8 + ModuleExtendedCDRs.getMaxWidth(flattenedData, col)\n\t\t\t\t\t}));\n\n\t\t\t\t\tconst workbook = XLSX.utils.book_new();\n\t\t\t\t\tXLSX.utils.book_append_sheet(workbook, worksheet, \"cdr\");\n\t\t\t\t\tXLSX.writeFile(workbook, \"history.xlsx\");\n\t\t\t\t}else{\n\t\t\t\t\tconst tableBody = [\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t{ text: globalTranslate.repModuleExtendedCDRs_cdr_ColumnTypeState, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: globalTranslate.cdr_ColumnDate, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: globalTranslate.cdr_ColumnFrom, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: globalTranslate.cdr_ColumnTo, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: globalTranslate.repModuleExtendedCDRs_cdr_ColumnLine, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: globalTranslate.repModuleExtendedCDRs_cdr_ColumnWaitTime, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: globalTranslate.cdr_ColumnDuration, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: globalTranslate.repModuleExtendedCDRs_cdr_ColumnCallState, style: 'tableHeader' },\n\t\t\t\t\t\t\t{ text: 'id', style: 'tableHeader' },\n\t\t\t\t\t\t]\n\t\t\t\t\t];\n\t\t\t\t\tflattenedData.forEach(item => {\n\t\t\t\t\t\ttableBody.push([\n\t\t\t\t\t\t\titem.typeCall,\n\t\t\t\t\t\t\titem.start,\n\t\t\t\t\t\t\titem.src_num,\n\t\t\t\t\t\t\titem.dst_num,\n\t\t\t\t\t\t\titem.line,\n\t\t\t\t\t\t\titem.waitTime,\n\t\t\t\t\t\t\titem.billsec,\n\t\t\t\t\t\t\titem.stateCall,\n\t\t\t\t\t\t\titem.id\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t\tconst docDefinition = {\n\t\t\t\t\t\tpageOrientation: 'landscape',\n\t\t\t\t\t\tcontent: [\n\t\t\t\t\t\t\t// { text: 'Call Details', style: 'header' },\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttable: {\n\t\t\t\t\t\t\t\t\theaderRows: 1,\n\t\t\t\t\t\t\t\t\twidths: ['auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto', 'auto'],\n\t\t\t\t\t\t\t\t\tbody: tableBody\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\t\tfillColor: function (rowIndex, node, columnIndex) {\n\t\t\t\t\t\t\t\t\t\treturn rowIndex === 0 ? '#CCCCCC' : null; // Цвет заливки для заголовка таблицы\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\theader: {\n\t\t\t\t\t\t\t\tfontSize: 18,\n\t\t\t\t\t\t\t\tbold: true,\n\t\t\t\t\t\t\t\tmargin: [0, 0, 0, 10]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttableHeader: {\n\t\t\t\t\t\t\t\tbold: true,\n\t\t\t\t\t\t\t\tfontSize: 12,\n\t\t\t\t\t\t\t\tcolor: 'black',\n\t\t\t\t\t\t\t\talignment: 'center'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tpdfMake.createPdf(docDefinition).download('history.pdf');\n\t\t\t\t}\n\n\t\t\t},\n\t\t\terror: function(xhr, status, error) {\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t});\n\t},\n\n\tgetMaxWidth(data, key) {\n\t\t// Получаем максимальную длину содержимого в столбце\n\t\tlet maxLength = key.length; // начинаем с длины заголовка\n\t\tdata.forEach(row => {\n\t\t\tlet length = (row[key] || '').toString().length;\n\t\t\tif (length > maxLength) maxLength = length;\n\t\t});\n\t\treturn maxLength;\n\t},\n\n\tstartDownload(){\n\t\tlet startTime = ModuleExtendedCDRs.$dateRangeSelector.attr('data-start');\n\t\tlet endTime   = ModuleExtendedCDRs.$dateRangeSelector.attr('data-end');\n\t\tif(startTime === undefined){\n\t\t\tstartTime = moment().format('YYYY-MM-DD');\n\t\t\tendTime   =  moment().endOf('day').format('YYYY-MM-DD HH:mm:ss')\n\t\t}\n\t\tlet typeRec = 'inner';\n\t\tif($('#allRecord').checkbox('is checked')){\n\t\t\ttypeRec = 'all';\n\t\t}else if($('#outRecord').checkbox('is checked')){\n\t\t\ttypeRec = 'out';\n\t\t}\n\t\tlet numbers = ModuleExtendedCDRs.$globalSearch.val();\n\t\twindow.open('/pbxcore/api/modules/'+className+'/downloads?start='+startTime+'&end='+endTime+\"&numbers=\"+encodeURIComponent(numbers)+\"&type=\"+typeRec, '_blank');\n\t},\n\n\tstartDownloadHistory(){\n\t\tlet startTime = ModuleExtendedCDRs.$dateRangeSelector.attr('data-start');\n\t\tlet endTime   = ModuleExtendedCDRs.$dateRangeSelector.attr('data-end');\n\t\tif(startTime === undefined){\n\t\t\tstartTime = moment().format('YYYY-MM-DD');\n\t\t\tendTime =  moment().endOf('day').format('YYYY-MM-DD HH:mm:ss')\n\t\t}\n\t\tlet typeRec = 'inner';\n\t\tif($('#allRecord').checkbox('is checked')){\n\t\t\ttypeRec = 'all';\n\t\t}else if($('#outRecord').checkbox('is checked')){\n\t\t\ttypeRec = 'out';\n\t\t}\n\t\tlet numbers = ModuleExtendedCDRs.$globalSearch.val();\n\t\twindow.open('/pbxcore/api/modules/'+className+'/downloads-history?start='+startTime+'&end='+endTime+\"&numbers=\"+encodeURIComponent(numbers)+\"&type=\"+typeRec, '_blank');\n\t},\n\n\t/**\n\t * Подготавливает список выбора\n\t * @param selected\n\t * @returns {[]}\n\t */\n\tmakeDropdownList(selectType, selected) {\n\t\tconst values = [\n\t\t\t{\n\t\t\t\tname: ' --- ',\n\t\t\t\tvalue: '',\n\t\t\t\tselected: ('' === selected),\n\t\t\t}\n\t\t];\n\t\t$('#'+selectType+' option').each((index, obj) => {\n\t\t\tvalues.push({\n\t\t\t\tname: obj.text,\n\t\t\t\tvalue: obj.value,\n\t\t\t\tselected: (selected === obj.value),\n\t\t\t});\n\t\t});\n\t\treturn values;\n\t},\n\n\t/**\n\t * Обработка изменения группы в списке\n\t */\n\tchangeGroupInList(value, text, choice) {\n\t\tlet tdInput = $(choice).closest('td').find('input');\n\t\ttdInput.attr('data-value', \tvalue);\n\t\ttdInput.attr('value', \t\tvalue);\n\t\tlet currentRowId = $(choice).closest('tr').attr('id');\n\t\tlet tableName    = $(choice).closest('table').attr('id').replace('-table', '');\n\t\tif (currentRowId !== undefined && tableName !== undefined) {\n\t\t\twindow[className].sendChangesToServer(tableName, currentRowId);\n\t\t}\n\t},\n\n\t/**\n\t * Add new Table.\n\t */\n\tinitTable(tableName, options) {\n\t\tlet columns = [];\n\t\tlet columnsArray4Sort = []\n\t\tfor (let colName in options['cols']) {\n\t\t\tcolumns.push( {data: colName});\n\t\t\tcolumnsArray4Sort.push(colName);\n\t\t}\n\t\t$('#' + tableName).DataTable( {\n\t\t\tajax: {\n\t\t\t\turl: idUrl + options.ajaxUrl + '?table=' +tableName.replace('-table', ''),\n\t\t\t\tdataSrc: 'data'\n\t\t\t},\n\t\t\tcolumns: columns,\n\t\t\tpaging: true,\n\t\t\tsDom: 'rtip',\n\t\t\tdeferRender: true,\n\t\t\tpageLength: 17,\n\t\t\tinfoCallback( settings, start, end, max, total, pre ) {\n\t\t\t\treturn '';\n\t\t\t},\n\t\t\tlanguage: SemanticLocalization.dataTableLocalisation,\n\t\t\tordering: false,\n\t\t\t/**\n\t\t\t * Builder row presentation\n\t\t\t * @param row\n\t\t\t * @param data\n\t\t\t */\n\t\t\tcreatedRow(row, data) {\n\t\t\t\tlet cols    = $('td', row);\n\t\t\t\tlet headers = $('#'+ tableName + ' thead tr th');\n\t\t\t\tfor (let key in data) {\n\t\t\t\t\tlet index = columnsArray4Sort.indexOf(key);\n\t\t\t\t\tif(key === 'rowIcon'){\n\t\t\t\t\t\tcols.eq(index).html('<i class=\"ui ' + data[key] + ' circle icon\"></i>');\n\t\t\t\t\t}else if(key === 'delButton'){\n\t\t\t\t\t\tlet templateDeleteButton = '<div class=\"ui small basic icon buttons action-buttons\">' +\n\t\t\t\t\t\t\t'<a href=\"' + window[className].deleteRecordAJAXUrl + '/' +\n\t\t\t\t\t\t\tdata.id + '\" data-value = \"' + data.DT_RowId + '\"' +\n\t\t\t\t\t\t\t' class=\"ui button delete two-steps-delete popuped\" data-content=\"' + globalTranslate.bt_ToolTipDelete + '\">' +\n\t\t\t\t\t\t\t'<i class=\"icon trash red\"></i></a></div>';\n\t\t\t\t\t\tcols.eq(index).html(templateDeleteButton);\n\t\t\t\t\t}else if(key === 'priority'){\n\t\t\t\t\t\tcols.eq(index).addClass('dragHandle')\n\t\t\t\t\t\tcols.eq(index).html('<i class=\"ui sort circle icon\"></i>');\n\t\t\t\t\t\t// Приоритет устанавливаем для строки.\n\t\t\t\t\t\t$(row).attr('m-priority', data[key]);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tlet template = '<div class=\"ui transparent fluid input inline-edit\">' +\n\t\t\t\t\t\t\t'<input colName=\"'+key+'\" class=\"'+inputClassName+'\" type=\"text\" data-value=\"'+data[key] + '\" value=\"' + data[key] + '\"></div>';\n\t\t\t\t\t\t$('td', row).eq(index).html(template);\n\t\t\t\t\t}\n\t\t\t\t\tif(options['cols'][key] === undefined){\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tlet additionalClass = options['cols'][key]['class'];\n\t\t\t\t\tif(additionalClass !== undefined && additionalClass !== ''){\n\t\t\t\t\t\theaders.eq(index).addClass(additionalClass);\n\t\t\t\t\t}\n\t\t\t\t\tlet header = options['cols'][key]['header'];\n\t\t\t\t\tif(header !== undefined && header !== ''){\n\t\t\t\t\t\theaders.eq(index).html(header);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet selectMetaData = options['cols'][key]['select'];\n\t\t\t\t\tif(selectMetaData !== undefined){\n\t\t\t\t\t\tlet newTemplate = $('#template-select').html().replace('PARAM', data[key]);\n\t\t\t\t\t\tlet template = '<input class=\"'+inputClassName+'\" colName=\"'+key+'\" selectType=\"'+selectMetaData+'\" style=\"display: none;\" type=\"text\" data-value=\"'+data[key] + '\" value=\"' + data[key] + '\"></div>';\n\t\t\t\t\t\tcols.eq(index).html(newTemplate + template);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t/**\n\t\t\t * Draw event - fired once the table has completed a draw.\n\t\t\t */\n\t\t\tdrawCallback(settings) {\n\t\t\t\twindow[className].drowSelectGroup(settings.sTableId);\n\t\t\t},\n\t\t} );\n\n\t\tlet body = $('body');\n\t\t// Клик по полю. Вход для редактирования значения.\n\t\tbody.on('focusin', '.'+inputClassName, function (e) {\n\t\t\t$(e.target).transition('glow');\n\t\t\t$(e.target).closest('div').removeClass('transparent').addClass('changed-field');\n\t\t\t$(e.target).attr('readonly', false);\n\t\t})\n\t\t// Отправка формы на сервер по Enter или Tab\n\t\t$(document).on('keydown', function (e) {\n\t\t\tlet keyCode = e.keyCode || e.which;\n\t\t\tif (keyCode === 13 || keyCode === 9 && $(':focus').hasClass('mikopbx-module-input')) {\n\t\t\t\twindow[className].endEditInput();\n\t\t\t}\n\t\t});\n\n\t\tbody.on('click', 'a.delete', function (e) {\n\t\t\te.preventDefault();\n\t\t\tlet currentRowId = $(e.target).closest('tr').attr('id');\n\t\t\tlet tableName    = $(e.target).closest('table').attr('id').replace('-table', '');\n\t\t\twindow[className].deleteRow(tableName, currentRowId);\n\t\t}); // Добавление новой строки\n\n\t\t// Отправка формы на сервер по уходу с поля ввода\n\t\tbody.on('focusout', '.'+inputClassName, window[className].endEditInput);\n\n\t\t// Кнопка \"Добавить новую запись\"\n\t\t$('[id-table = \"'+tableName+'\"]').on('click', window[className].addNewRow);\n\t},\n\n\t/**\n\t * Перемещение строки, изменение приоритета.\n\t */\n\tcbOnDrop(table, row) {\n\t\tlet priorityWasChanged = false;\n\t\tconst priorityData = {};\n\t\t$(table).find('tr').each((index, obj) => {\n\t\t\tconst ruleId = $(obj).attr('id');\n\t\t\tconst oldPriority = parseInt($(obj).attr('m-priority'), 10);\n\t\t\tconst newPriority = obj.rowIndex;\n\t\t\tif (!isNaN( ruleId ) && oldPriority !== newPriority) {\n\t\t\t\tpriorityWasChanged = true;\n\t\t\t\tpriorityData[ruleId] = newPriority;\n\t\t\t}\n\t\t});\n\t\tif (priorityWasChanged) {\n\t\t\t$.api({\n\t\t\t\ton: 'now',\n\t\t\t\turl: `${globalRootUrl}${idUrl}/changePriority?table=`+$(table).attr('id').replace('-table', ''),\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdata: priorityData,\n\t\t\t});\n\t\t}\n\t},\n\n\t/**\n\t * Окончание редактирования поля ввода.\n\t * Не относится к select.\n\t * @param e\n\t */\n\tendEditInput(e){\n\t\tlet $el = $('.changed-field').closest('tr');\n\t\t$el.each(function (index, obj) {\n\t\t\tlet currentRowId = $(obj).attr('id');\n\t\t\tlet tableName    = $(obj).closest('table').attr('id').replace('-table', '');\n\t\t\tif (currentRowId !== undefined && tableName !== undefined) {\n\t\t\t\twindow[className].sendChangesToServer(tableName, currentRowId);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Добавление новой строки в таблицу.\n\t * @param e\n\t */\n\taddNewRow(e){\n\t\tlet idTable = $(e.target).attr('id-table');\n\t\tlet table   = $('#'+idTable);\n\t\te.preventDefault();\n\t\ttable.find('.dataTables_empty').remove();\n\t\t// Отправим на запись все что не записано еще\n\t\tlet $el = table.find('.changed-field').closest('tr');\n\t\t$el.each(function (index, obj) {\n\t\t\tlet currentRowId = $(obj).attr('id');\n\t\t\tif (currentRowId !== undefined) {\n\t\t\t\twindow[className].sendChangesToServer(currentRowId);\n\t\t\t}\n\t\t});\n\t\tlet id = \"new\"+Math.floor(Math.random() * Math.floor(500));\n\t\tlet rowTemplate = '<tr id=\"'+id+'\" role=\"row\" class=\"even\">'+table.find('tr#TEMPLATE').html().replace('TEMPLATE', id)+'</tr>';\n\t\ttable.find('tbody > tr:first').before(rowTemplate);\n\t\twindow[className].drowSelectGroup(idTable);\n\t},\n\t/**\n\t * Обновление select элементов.\n\t * @param tableId\n\t */\n\tdrowSelectGroup(tableId) {\n\t\t$('#' + tableId).find('tr#TEMPLATE').hide();\n\t\tlet selestGroup = $('.select-group');\n\t\tselestGroup.each((index, obj) => {\n\t\t\tlet selectType = $(obj).closest('td').find('input').attr('selectType');\n\t\t\t$(obj).dropdown({\n\t\t\t\tvalues: window[className].makeDropdownList(selectType, $(obj).attr('data-value')),\n\t\t\t});\n\t\t});\n\t\tselestGroup.dropdown({\n\t\t\tonChange: window[className].changeGroupInList,\n\t\t});\n\n\t\t$('#' + tableId).tableDnD({\n\t\t\tonDrop: window[className].cbOnDrop,\n\t\t\tonDragClass: 'hoveringRow',\n\t\t\tdragHandle: '.dragHandle',\n\t\t});\n\t},\n\n\t/**\n\t * Удаление строки\n\t * @param tableName\n\t * @param id - record id\n\t */\n\tdeleteRow(tableName, id) {\n\t\tlet table = $('#'+ tableName+'-table');\n\t\tif (id.substr(0,3) === 'new') {\n\t\t\ttable.find('tr#'+id).remove();\n\t\t\treturn;\n\t\t}\n\t\t$.api({\n\t\t\turl: window[className].deleteRecordAJAXUrl+'?id='+id+'&table='+tableName,\n\t\t\ton: 'now',\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\ttable.find('tr#'+id).remove();\n\t\t\t\t\tif (table.find('tbody > tr').length === 0) {\n\t\t\t\t\t\ttable.find('tbody').append('<tr class=\"odd\"></tr>');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Отправка данных на сервер при измении\n\t */\n\tsendChangesToServer(tableName, recordId) {\n\t\tlet data = { 'pbx-table-id': tableName, 'pbx-row-id':  recordId};\n\t\tlet notEmpty = false;\n\t\t$(\"tr#\"+recordId + ' .' + inputClassName).each(function (index, obj) {\n\t\t\tlet colName = $(obj).attr('colName');\n\t\t\tif(colName !== undefined){\n\t\t\t\tdata[$(obj).attr('colName')] = $(obj).val();\n\t\t\t\tif($(obj).val() !== ''){\n\t\t\t\t\tnotEmpty = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif(notEmpty === false){\n\t\t\treturn;\n\t\t}\n\t\t$(\"tr#\"+recordId+\" .user.circle\").removeClass('user circle').addClass('spinner loading');\n\t\t$.api({\n\t\t\turl: window[className].saveTableAJAXUrl,\n\t\t\ton: 'now',\n\t\t\tmethod: 'POST',\n\t\t\tdata: data,\n\t\t\tsuccessTest(response) {\n\t\t\t\treturn response !== undefined && Object.keys(response).length > 0 && response.success === true;\n\t\t\t},\n\t\t\tonSuccess(response) {\n\t\t\t\tif (response.data !== undefined) {\n\t\t\t\t\tlet rowId = response.data['pbx-row-id'];\n\t\t\t\t\tlet table = $('#'+response.data['pbx-table-id']+'-table');\n\t\t\t\t\ttable.find(\"tr#\" + rowId + \" input\").attr('readonly', true);\n\t\t\t\t\ttable.find(\"tr#\" + rowId + \" div\").removeClass('changed-field loading').addClass('transparent');\n\t\t\t\t\ttable.find(\"tr#\" + rowId + \" .spinner.loading\").addClass('user circle').removeClass('spinner loading');\n\n\t\t\t\t\tif (rowId !== response.data['newId']){\n\t\t\t\t\t\t$(`tr#${rowId}`).attr('id', response.data['newId']);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonFailure(response) {\n\t\t\t\tif (response.message !== undefined) {\n\t\t\t\t\tUserMessage.showMultiString(response.message);\n\t\t\t\t}\n\t\t\t\t$(\"tr#\" + recordId + \" .spinner.loading\").addClass('user circle').removeClass('spinner loading');\n\t\t\t},\n\t\t\tonError(errorMessage, element, xhr) {\n\t\t\t\tif (xhr.status === 403) {\n\t\t\t\t\twindow.location = globalRootUrl + \"session/index\";\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Change some form elements classes depends of module status\n\t */\n\tcheckStatusToggle() {\n\t\tif (window[className].$statusToggle.checkbox('is checked')) {\n\t\t\twindow[className].$disabilityFields.removeClass('disabled');\n\t\t\twindow[className].$moduleStatus.show();\n\t\t} else {\n\t\t\twindow[className].$disabilityFields.addClass('disabled');\n\t\t\twindow[className].$moduleStatus.hide();\n\t\t}\n\t},\n\n\t/**\n\t * Send command to restart module workers after data changes,\n\t * Also we can do it on TemplateConf->modelsEventChangeData method\n\t */\n\tapplyConfigurationChanges() {\n\t\twindow[className].changeStatus('Updating');\n\t\t$.api({\n\t\t\turl: `${Config.pbxUrl}/pbxcore/api/modules/`+className+`/reload`,\n\t\t\ton: 'now',\n\t\t\tsuccessTest(response) {\n\t\t\t\t// test whether a JSON response is valid\n\t\t\t\treturn Object.keys(response).length > 0 && response.result === true;\n\t\t\t},\n\t\t\tonSuccess() {\n\t\t\t\twindow[className].changeStatus('Connected');\n\t\t\t},\n\t\t\tonFailure() {\n\t\t\t\twindow[className].changeStatus('Disconnected');\n\t\t\t},\n\t\t});\n\t},\n\n\t/**\n\t * We can modify some data before form send\n\t * @param settings\n\t * @returns {*}\n\t */\n\tcbBeforeSendForm(settings) {\n\t\tconst result = settings;\n\t\tresult.data = window[className].$formObj.form('get values');\n\t\treturn result;\n\t},\n\n\t/**\n\t * Some actions after forms send\n\t */\n\tcbAfterSendForm() {\n\t\twindow[className].applyConfigurationChanges();\n\t},\n\n\t/**\n\t * Initialize form parameters\n\t */\n\tinitializeForm() {\n\t\tForm.$formObj = window[className].$formObj;\n\t\tForm.url = `${globalRootUrl}${idUrl}/save`;\n\t\tForm.validateRules = window[className].validateRules;\n\t\tForm.cbBeforeSendForm = window[className].cbBeforeSendForm;\n\t\tForm.cbAfterSendForm = window[className].cbAfterSendForm;\n\t\tForm.initialize();\n\t},\n\n\t/**\n\t * Update the module state on form label\n\t * @param status\n\t */\n\tchangeStatus(status) {\n\t\tswitch (status) {\n\t\t\tcase 'Connected':\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('grey')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('green');\n\t\t\t\twindow[className].$moduleStatus.html(globalTranslate.module_export_recordsConnected);\n\t\t\t\tbreak;\n\t\t\tcase 'Disconnected':\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\twindow[className].$moduleStatus.html(globalTranslate.module_export_recordsDisconnected);\n\t\t\t\tbreak;\n\t\t\tcase 'Updating':\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\twindow[className].$moduleStatus.html(`<i class=\"spinner loading icon\"></i>${globalTranslate.module_export_recordsUpdateStatus}`);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\twindow[className].$moduleStatus\n\t\t\t\t\t.removeClass('green')\n\t\t\t\t\t.removeClass('red')\n\t\t\t\t\t.addClass('grey');\n\t\t\t\twindow[className].$moduleStatus.html(globalTranslate.module_export_recordsDisconnected);\n\t\t\t\tbreak;\n\t\t}\n\t},\n};\n\n$(document).ready(() => {\n\twindow[className].initialize();\n});\n\n"],"file":"module-export-records-index.js"}